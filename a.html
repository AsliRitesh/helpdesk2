<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <div id="loginactive">
        <form action="https://sheetdb.io/api/v1/o3nxu9n6otryl" method="post" id="logindb">
            <input type="text" id="user" name="data[username]">
            <input type="text" name="data[time]" id="time">
            <input type="submit" name="subme" id="subme">
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var cookieString = document.cookie;
            var cookies = cookieString.split(';');
            var len = cookies.length;

            // Loop through cookies
            for (let i = 0; i < len; i++) {
                var n = cookies[i].trim().split("=");

                // Check if cookie name is "name"
                if (n[0] === "name") {
                    // Set values in the form
                    document.getElementById("user").value = n[1];
                    document.getElementById("time").value = "1";

                    // Prevent the default form submission behavior
                    var form = document.getElementById('logindb');
                    form.addEventListener("submit", function (e) {
                        e.preventDefault();

                        // Serialize the form data
                        var formData = new FormData(form);

                        // Fetch API call
                        fetch(form.action, {
                            method: "POST",
                            body: formData,
                        })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`HTTP error! Status: ${response.status}`);
                            }
                            return response.json();
                        })
                        .then(html => {
                            console.log("Done");
                            // You can add further actions here if needed
                        })
                        .catch(error => {
                            console.error("Error:", error);
                        });
                    });

                    // Manually submit the form after setting values
                    setTimeout(function () {
                        form.submit();
                    }, 1000); // Delay for 1 second

                    break; // Exit loop if "name" cookie is found
                }
            }
        });
    </script>
</body>

</html>
